(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{ec2d:function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var a=s("60a3");class i extends a["b"]{}},ec95:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticClass:"items-start justify-start q-pa-md"},[s("q-ajax-bar",{attrs:{position:"top",color:"secondary",size:"2px","skip-hijack":""}}),s("div",{staticClass:"row items-center"},[s("div",{staticClass:"q-pa-sm"},[s("span",{staticClass:"q-pr-sm text-weight-medium"},[t._v("Project:")]),s("q-btn-dropdown",{attrs:{color:"primary","no-caps":"",icon:"list",label:t.currentWorkspace.name}},[s("q-list",t._l(t.projects,(function(e){return s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:e.slug,attrs:{clickable:""},on:{click:function(s){return t.switchProject(e.slug)}}},[s("q-item-section",[s("q-item-label",[t._v(t._s(e.name))])],1)],1)})),1)],1)],1),s("div",{staticClass:"q-pa-sm"},[s("q-btn-dropdown",{attrs:{color:"secondary","no-caps":"",icon:"sort",label:t.sortAsc?"Oldest first":"Newest first"}},[s("q-list",[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){t.sortAsc=!0}}},[s("q-item-section",[s("q-item-label",[t._v("Oldest first")])],1)],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){t.sortAsc=!1}}},[s("q-item-section",[s("q-item-label",[t._v("Newest first")])],1)],1)],1)],1)],1),s("div",{staticClass:"q-pa-sm"},[s("q-select",{staticStyle:{"min-width":"250px"},attrs:{clearable:"",label:"Repositories",multiple:"",options:t.repos},model:{value:t.selectedRepos,callback:function(e){t.selectedRepos=e},expression:"selectedRepos"}})],1),s("div",{staticClass:"q-pa-sm"},[s("q-input",{staticStyle:{"max-width":"200px"},attrs:{label:"Reload after seconds",type:"number"},model:{value:t.intervalSecs,callback:function(e){t.intervalSecs=t._n(e)},expression:"intervalSecs"}})],1),s("span",{staticClass:"q-pr-sm text-weight-medium"},[t._v("Reload in "+t._s(t.reloadAfter))]),s("q-btn",{attrs:{color:"warning"},on:{click:function(e){t.timeToReload=new Date}}},[t._v("Reload now")])],1),t._l(t.selectedRepos,(function(e){return s("q-list",{key:e},[s("q-item-label",{staticClass:"text-h6"},[t._v(t._s(e))]),t._l(t.pullRequests[e],(function(a){return[s("q-separator",{key:"sp-"+a.id,attrs:{spaced:""}}),s("q-item",{key:"item-"+a.id},[s("q-item-section",{staticClass:"col justify-center",attrs:{top:""}},[s("q-btn-dropdown",{staticStyle:{width:"100px"},attrs:{size:"sm",loading:t.loading,color:t.titleStateColor(a.title),label:t.titleStateName(a.title)}},[s("q-list",t._l(t.states,(function(i){return s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:i.name,attrs:{clickable:""},on:{click:function(s){return t.switchState(i.name,a,e)}}},[s("q-item-section",[s("q-item-label",[t._v(t._s(i.name))])],1)],1)})),1)],1)],1),s("q-item-section",{staticClass:"col-11",attrs:{top:""}},[s("q-item-label",{attrs:{lines:"1"}},[s("a",{staticClass:"q-mr-sm text-body2 text-weight-bold text-primary cursor-pointer",attrs:{href:a.links.html.href,target:"_blank"}},[t._v(t._s(t.trimTitle(a.title)))]),s("q-chip",[s("q-avatar",[s("img",{attrs:{src:a.author.links.avatar.href}})]),t._v("\n              "+t._s(a.author.display_name)+"\n            ")],1),t._l(a.participants,(function(e){return s("q-avatar",{key:e.user.uuid,attrs:{size:"30px"}},[s("img",{attrs:{src:e.user.links.avatar.href}}),e.approved?s("q-badge",{staticStyle:{width:"13px",height:"13px",padding:"3px"},attrs:{floating:"",color:"green"}},[s("q-icon",{attrs:{name:"check",size:"5px"}})],1):t._e()],1)}))],2),s("q-item-label",{attrs:{lines:"1"}},[s("q-badge",{staticClass:"q-mr-xs",attrs:{color:t.countBuild(a,"SUCCESSFUL")?"positive":"grey","text-color":"white"}},[t._v("\n              "+t._s(t.countBuild(a,"SUCCESSFUL"))+"\n              "),s("q-icon",{staticClass:"q-ml-xs",attrs:{name:"check_circle",size:"20px"}})],1),s("q-badge",{staticClass:"q-mr-xs",attrs:{color:t.countBuild(a,"INPROGRESS")?"primary":"grey","text-color":"white"}},[t._v("\n              "+t._s(t.countBuild(a,"INPROGRESS"))+"\n              "),s("q-icon",{staticClass:"q-ml-xs",attrs:{name:"change_circle",size:"20px"}})],1),s("q-badge",{staticClass:"q-mr-xs",attrs:{color:t.countBuild(a,"FAILED")?"negative":"grey","text-color":"white"}},[t._v("\n              "+t._s(t.countBuild(a,"FAILED"))+"\n              "),s("q-icon",{staticClass:"q-ml-xs",attrs:{name:"cancel",size:"20px"}})],1),s("q-badge",{staticClass:"q-mr-xs",attrs:{color:a.comment_count?"cyan":"grey","text-color":"white"}},[t._v("\n              "+t._s(a.comment_count)+" comments\n              "),s("q-icon",{staticClass:"q-ml-xs",attrs:{name:"message",size:"20px"}})],1),s("q-badge",{staticClass:"q-mr-xs",attrs:{color:a.task_count?"teal":"grey","text-color":"white"}},[t._v("\n              "+t._s(a.task_count)+" tasks\n              "),s("q-icon",{staticClass:"q-ml-xs",attrs:{name:"check_box",size:"20px"}})],1),s("span",{staticClass:"text-grey-8"},[t._v("\n              Last updated: "+t._s(t.pastRelativeDateTime(a.updated_on))+"\n              "),s("q-tooltip",[t._v(t._s(t.fullDateTime(a.updated_on)))])],1)],1)],1)],1)]}))],2)}))],2)},i=[],o=s("60a3"),r=s("ec2d"),n=s("bd4c"),c=function(t,e,s,a){var i,o=arguments.length,r=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,s):a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(t,e,s,a);else for(var n=t.length-1;n>=0;n--)(i=t[n])&&(r=(o<3?i(r):o>3?i(e,s,r):i(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},l=function(t,e,s,a){function i(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,o){function r(t){try{c(a.next(t))}catch(e){o(e)}}function n(t){try{c(a["throw"](t))}catch(e){o(e)}}function c(t){t.done?s(t.value):i(t.value).then(r,n)}c((a=a.apply(t,e||[])).next())}))};let u=class extends r["a"]{constructor(){super(...arguments),this.selectedRepos=[],this.states={WIP:{name:"WIP",color:"warning"},READY:{name:"READY",color:"positive"},REVIEWING:{name:"REVIEWING",color:"info"}}}data(){return{workspace:this.$route.params.workspace,selectedRepos:[],loading:!1,sortAsc:!1,intervalSecs:300,timeToReload:new Date(Date.now()+3e5),now:new Date,interval:null}}beforeDestroy(){this.interval&&clearInterval(this.interval)}countBuild(t,e){return t.statuses&&0!==t.statuses.values.length?t.statuses.values.filter((t=>t.state===e)).length:0}switchState(t,e,s){return l(this,void 0,void 0,(function*(){const a="READY"===t?this.trimTitle(e.title):`[${t}]${this.trimTitle(e.title)}`;if(a!==e.title){this.loading=!0;try{yield this.$store.dispatch("bitbucket/setPullRequestTitle",{pullRequest:e,title:a}),yield this.$store.dispatch("bitbucket/updateRepositoryPullRequests",{repository:s,workspace:this.currentWorkspace})}catch(i){this.$q.notify("Update pull request state failed")}this.loading=!1}}))}titleState(t){const e=/^\[(\w+)\].*/.exec(t);return e&&this.states[e[1]]||this.states.READY}titleStateName(t){return this.titleState(t).name}titleStateColor(t){return this.titleState(t).color}trimTitle(t){const e=/^\[(\w+)\]\s*(.*)/.exec(t);return e&&this.states[e[1]]?e[2]:t}switchProject(t){this.$router.push({path:`/dashboard/${t}`})}onCurrentWorkspaceChanged(t){return l(this,void 0,void 0,(function*(){this.$store.commit("app/title",t.name),yield this.$store.dispatch("bitbucket/loadRepositories",this.currentWorkspace)}))}onIntervalSecsChanged(t){this.timeToReload=new Date(Date.now()+1e3*t)}onSelectedReposChanged(t,e){return l(this,void 0,void 0,(function*(){yield this.$store.dispatch("bitbucket/updateShowRepositories",{workspace:this.currentWorkspace,oldRepositories:e,newRepositories:t})}))}fullDateTime(t){const e=new Date(t);return n["a"].formatDate(e,"Do, MMM YYYY (ddd) HH:mm:ss")}pastRelativeDateTime(t){const e=new Date(t),s=n["a"].getDateDiff(new Date,e,"days"),a=n["a"].getDateDiff(new Date,e,"hours"),i=n["a"].getDateDiff(new Date,e,"minutes"),o=n["a"].getDateDiff(new Date,e,"seconds");let r="just now";return s?r=`${s} day(s) ago`:a?r=`${a} hour(s) ago`:i?r=`${i} minute(s) ago`:o&&(r=`${o} seconds(s) ago`),r}get reloadAfter(){const t=n["a"].getDateDiff(this.timeToReload,this.now,"days"),e=n["a"].getDateDiff(this.timeToReload,this.now,"hours"),s=n["a"].getDateDiff(this.timeToReload,this.now,"minutes"),a=n["a"].getDateDiff(this.timeToReload,this.now,"seconds");let i="now";return t?i=`${t} day(s)`:e?i=`${e} hour(s)`:s?i=`${s} minute(s)`:a&&(i=`${a} second(s)`),i}get repos(){return null===this.$store.state.bitbucket.repositories?[]:this.$store.state.bitbucket.repositories.values.map((t=>t.slug))}get pullRequests(){const t={};for(const e of this.selectedRepos){const s=Object.values(this.$store.state.bitbucket.pullRequests[e]||[]);s.sort(((t,e)=>{const s=new Date(t.updated_on),a=new Date(e.updated_on);return this.sortAsc?s.getTime()-a.getTime():a.getTime()-s.getTime()})),t[e]=s}return t}get currentWorkspace(){return null===this.$store.state.bitbucket.workspaces?{name:"",slug:""}:this.$store.state.bitbucket.workspaces.values.find((t=>t.slug===this.$route.params.workspace))||this.$store.state.bitbucket.workspaces.values[0]}get projects(){var t;return(null===(t=this.$store.state.bitbucket.workspaces)||void 0===t?void 0:t.values)||[]}mounted(){return l(this,void 0,void 0,(function*(){if(null===this.$store.state.bitbucket.workspaces&&(yield this.$store.dispatch("bitbucket/loadWorkspaces")),!this.currentWorkspace.slug)return this.$q.notify("Unable to load workspaces"),this.$store.commit("bitbucket/logout"),void this.$router.push({path:"/"});this.$route.params.workspace||this.$router.push({path:`/dashboard/${this.currentWorkspace.slug}`}),this.interval&&clearInterval(this.interval),this.interval=setInterval((()=>{Date.now()>=this.timeToReload.getTime()&&(this.timeToReload=new Date(Date.now()+1e3*this.intervalSecs),this.$store.dispatch("bitbucket/updateShowRepositories",{workspace:this.currentWorkspace,oldRepositories:[],newRepositories:this.selectedRepos})),this.now=new Date}),1e3)}))}};c([Object(o["c"])("currentWorkspace")],u.prototype,"onCurrentWorkspaceChanged",null),c([Object(o["c"])("intervalSecs")],u.prototype,"onIntervalSecsChanged",null),c([Object(o["c"])("selectedRepos")],u.prototype,"onSelectedReposChanged",null),u=c([Object(o["a"])({})],u);var p=u,d=p,h=s("2877"),m=s("9989"),b=s("7ea5"),v=s("f20b"),f=s("1c1c"),w=s("66e5"),g=s("4074"),q=s("0170"),k=s("ddd8"),R=s("27f9"),y=s("9c40"),_=s("eb85"),x=s("b047"),D=s("cb32"),C=s("58a81"),S=s("0016"),$=s("05c0"),T=s("7f67"),j=s("eebe"),I=s.n(j),Q=Object(h["a"])(d,a,i,!1,null,null,null);e["default"]=Q.exports;I()(Q,"components",{QPage:m["a"],QAjaxBar:b["a"],QBtnDropdown:v["a"],QList:f["a"],QItem:w["a"],QItemSection:g["a"],QItemLabel:q["a"],QSelect:k["a"],QInput:R["a"],QBtn:y["a"],QSeparator:_["a"],QChip:x["a"],QAvatar:D["a"],QBadge:C["a"],QIcon:S["a"],QTooltip:$["a"]}),I()(Q,"directives",{ClosePopup:T["a"]})}}]);